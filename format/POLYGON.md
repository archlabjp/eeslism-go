# POLYGON（多角形定義）

## 概要
POLYGON（Polygon）は、複雑な形状の建物面や障害物を多角形として直接定義するデータセットです。3～6角形の任意形状を頂点座標で詳細に指定することで、標準的な矩形では表現できない複雑な建物形状、地形、障害物による日射遮蔽効果を正確にシミュレーションできます。建築設計の自由度向上と、現実的な環境条件のモデル化に重要な機能です。

## データ形式
```
POLYGON
    <多角形名>
        polyknd=<多角形種類>
        wallname=<壁名称>
        polyd=<頂点数>
        ref=<反射率> refg=<地面反射率>
        grpx=<地面代表点距離>
        rgb=<R> <G> <B>
        P=<X1> <Y1> <Z1> <X2> <Y2> <Z2> ... <Xn> <Yn> <Zn>
    ;
    ... 繰り返し
*
```

## パラメータ説明

| パラメータ | 単位 | 説明 | デフォルト値 | 参照 |
|:---|:---|:---|:---|:---|
| 多角形名 | - | 多角形の識別名 | - | 必須 |
| 多角形種類 | - | 多角形のタイプ（RMP/OBS） | - | 必須 |
| 壁名称 | - | 関連する壁体名称 | - | RMP時必須 |
| 頂点数 | - | 多角形の頂点数（3-6） | - | 必須 |
| 反射率 | - | 面の日射反射率（0.0-1.0） | - | 必須 |
| 地面反射率 | - | 前面地面の反射率（0.0-1.0） | - | 必須 |
| 地面代表点距離 | m | 前面地面代表点までの距離 | 1.0 | 任意 |
| R,G,B | - | 表示色（0.0-1.0） | - | 必須 |
| 頂点座標 | m | 各頂点のX,Y,Z座標 | - | 必須 |

## 多角形種類一覧

| 種類 | 説明 | 用途 | 壁名称 |
|:---|:---|:---|:---|
| `RMP` | 建物表面パネル | 建物の外壁・屋根面 | 必須 |
| `OBS` | 外部障害物 | 隣接建物・構造物 | 不要 |

## 頂点数による分類

| 頂点数 | 形状 | 用途例 |
|:---|:---|:---|
| 3 | 三角形 | 三角屋根、切妻端部 |
| 4 | 四角形 | 一般的な壁面、矩形屋根 |
| 5 | 五角形 | 複雑な屋根形状 |
| 6 | 六角形 | 特殊建築、複合形状 |

## 使用例

### 基本的な建物面（RMP）
```
POLYGON
    TriangularRoof
        polyknd=RMP
        wallname=RoofMaterial
        polyd=3
        ref=0.3 refg=0.2
        grpx=2.0
        rgb=0.8 0.6 0.4
        P=0.0 0.0 8.0 10.0 0.0 8.0 5.0 0.0 12.0 ;
    
    TrapezoidalWall
        polyknd=RMP
        wallname=ExteriorWall
        polyd=4
        ref=0.4 refg=0.2
        grpx=1.5
        rgb=0.7 0.7 0.8
        P=0.0 0.0 0.0 12.0 0.0 0.0 10.0 0.0 6.0 2.0 0.0 6.0 ;
*
```

### 複雑な障害物（OBS）
```
POLYGON
    IrregularBuilding
        polyknd=OBS
        wallname=
        polyd=6
        ref=0.3 refg=0.2
        grpx=5.0
        rgb=0.6 0.6 0.7
        P=0.0 0.0 0.0 15.0 5.0 0.0 20.0 15.0 0.0 15.0 25.0 0.0 5.0 20.0 0.0 -5.0 10.0 0.0 ;
    
    LShapedStructure
        polyknd=OBS
        wallname=
        polyd=6
        ref=0.4 refg=0.2
        grpx=3.0
        rgb=0.8 0.7 0.6
        P=0.0 0.0 0.0 10.0 0.0 0.0 10.0 0.0 15.0 15.0 0.0 15.0 15.0 0.0 5.0 0.0 0.0 5.0 ;
*
```

### 地形に沿った建物面
```
POLYGON
    SlopedRoof
        polyknd=RMP
        wallname=SlopedRoofMaterial
        polyd=4
        ref=0.25 refg=0.15
        grpx=2.5
        rgb=0.9 0.8 0.7
        P=0.0 0.0 6.0 20.0 0.0 8.0 20.0 15.0 10.0 0.0 15.0 8.0 ;
    
    TerraceWall
        polyknd=RMP
        wallname=RetainingWall
        polyd=5
        ref=0.35 refg=0.2
        grpx=1.0
        rgb=0.6 0.7 0.6
        P=0.0 0.0 0.0 8.0 0.0 0.0 10.0 0.0 2.0 8.0 0.0 4.0 0.0 0.0 3.0 ;
*
```

### 特殊建築形状
```
POLYGON
    CurvedApproximation1
        polyknd=RMP
        wallname=CurtainWall
        polyd=6
        ref=0.2 refg=0.2
        grpx=3.0
        rgb=0.8 0.9 1.0
        P=0.0 0.0 0.0 3.0 1.0 0.0 5.0 3.0 0.0 5.0 7.0 0.0 3.0 9.0 0.0 0.0 8.0 0.0 ;
    
    SkylightPanel
        polyknd=RMP
        wallname=GlazedRoof
        polyd=4
        ref=0.1 refg=0.2
        grpx=4.0
        rgb=0.9 0.9 1.0
        P=5.0 5.0 8.0 15.0 5.0 8.5 15.0 15.0 9.0 5.0 15.0 8.5 ;
*
```

## 頂点座標の定義

### 座標系
- **X軸**: 東方向が正
- **Y軸**: 北方向が正  
- **Z軸**: 上方向が正

### 頂点順序
頂点は**反時計回り**で定義します（外向き法線ベクトルが正しく計算されるため）：

#### 垂直面の場合
```
P=X1 Y1 Z1(下左) X2 Y2 Z2(下右) X3 Y3 Z3(上右) X4 Y4 Z4(上左)
```

#### 水平面の場合
```
P=X1 Y1 Z1(南西) X2 Y2 Z2(南東) X3 Y3 Z3(北東) X4 Y4 Z4(北西)
```

## 形状設計の指針

### 三角形（polyd=3）
```
POLYGON
    TriangleExample
        polyknd=RMP
        wallname=TriangleWall
        polyd=3
        ref=0.3 refg=0.2
        grpx=1.5
        rgb=0.8 0.7 0.6
        P=0.0 0.0 0.0 6.0 0.0 0.0 3.0 0.0 4.0 ;
*
```
- **用途**: 切妻屋根端部、三角窓
- **注意**: 鋭角を避け、適度な角度を保つ

### 四角形（polyd=4）
```
POLYGON
    QuadExample
        polyknd=RMP
        wallname=StandardWall
        polyd=4
        ref=0.4 refg=0.2
        grpx=2.0
        rgb=0.7 0.7 0.8
        P=0.0 0.0 0.0 8.0 0.0 0.0 8.0 0.0 3.0 0.0 0.0 3.0 ;
*
```
- **用途**: 一般的な壁面、矩形開口部
- **注意**: 平行四辺形や台形も可能

### 五角形・六角形（polyd=5,6）
```
POLYGON
    ComplexExample
        polyknd=RMP
        wallname=ComplexWall
        polyd=5
        ref=0.35 refg=0.2
        grpx=2.5
        rgb=0.8 0.8 0.9
        P=0.0 0.0 0.0 4.0 0.0 0.0 6.0 0.0 2.0 4.0 0.0 4.0 0.0 0.0 3.0 ;
*
```
- **用途**: 複雑な建築形状、特殊屋根
- **注意**: 凹形状は避け、凸形状で定義

## 材料特性の設定

### 反射率の設定指針
| 材料 | 反射率 | 用途 |
|:---|:---|:---|
| コンクリート | 0.2-0.4 | 一般外壁 |
| 金属パネル | 0.3-0.7 | 工業建築 |
| ガラス | 0.1-0.3 | カーテンウォール |
| 瓦屋根 | 0.1-0.3 | 伝統屋根 |
| 白色塗装 | 0.7-0.9 | 高反射仕様 |

### 地面反射率
| 地面材料 | 反射率 | 環境 |
|:---|:---|:---|
| アスファルト | 0.1-0.2 | 道路・駐車場 |
| コンクリート | 0.2-0.4 | 歩道・広場 |
| 芝生 | 0.15-0.25 | 緑地 |
| 砂利 | 0.2-0.3 | 庭園 |
| 水面 | 0.05-0.1 | 池・水路 |

## 設計上の考慮事項

### 幾何学的制約
1. **平面性**: 全頂点が同一平面上にあること
2. **凸形状**: 凹形状は複数の凸多角形に分割
3. **頂点順序**: 反時計回りの順序を厳守
4. **最小角度**: 極端に鋭い角度を避ける

### モデル化精度
1. **重要度**: 日射に大きく影響する面を優先
2. **簡略化**: 複雑形状の適切な近似
3. **分割**: 大きな面の適切な分割
4. **統合**: 小さな面の統合検討

## 複雑建築への応用

### 曲面の近似
```
POLYGON
    CurvedWallSegment1
        polyknd=RMP wallname=CurvedWall polyd=4
        ref=0.3 refg=0.2 grpx=2.0 rgb=0.8 0.8 0.9
        P=0.0 0.0 0.0 2.0 0.2 0.0 2.0 0.2 3.0 0.0 0.0 3.0 ;
    
    CurvedWallSegment2
        polyknd=RMP wallname=CurvedWall polyd=4
        ref=0.3 refg=0.2 grpx=2.0 rgb=0.8 0.8 0.9
        P=2.0 0.2 0.0 4.0 0.8 0.0 4.0 0.8 3.0 2.0 0.2 3.0 ;
*
```

### 傾斜屋根
```
POLYGON
    ShedRoof
        polyknd=RMP wallname=MetalRoof polyd=4
        ref=0.4 refg=0.2 grpx=3.0 rgb=0.7 0.7 0.8
        P=0.0 0.0 6.0 20.0 0.0 6.0 20.0 15.0 9.0 0.0 15.0 9.0 ;
*
```

## 出力データ

多角形に関する以下の項目が出力されます：
- 面への入射日射量
- 反射日射量
- 日射遮蔽効果
- 形態係数
- 表面温度

## 関連データセット

- [OBS](OBS.md): 標準形状の障害物
- [TREE](TREE.md): 樹木による遮蔽
- [COORDNT](COORDNT.md): 座標変換・日射計算
- [WALL](WALL.md): 壁体材料特性
- [SUNBRK](SUNBRK.md): 建物付属の日除け

## 注意事項

1. **頂点順序**: 反時計回りの順序を厳守
2. **平面性**: 全頂点の同一平面確認
3. **形状検証**: 自己交差のない凸形状
4. **座標精度**: 正確な測量データの使用
5. **計算負荷**: 複雑形状による計算時間増加