
# `format/*.md` vs `*.go` 比較分析計画書

## 1. 目的

本計画書は、`format/` ディレクトリ内の仕様書（.md）と `eeslism/` ディレクトリ内の実装コードおよびテストコード（.go）の間の整合性を確保し、テストの網羅性を向上させるための分析項目と手順を定義する。

## 2. 分析対象とチェックリスト

| 仕様書 (.md) | Goテストファイル (.go) | Goソースファイル (.go) | 分析・検証項目チェックリスト | 優先度 |
| :--- | :--- | :--- | :--- | :--- |
| **全体** | `(N/A)` | `DATAIN.go`, `eeinput_s.go` | - **[最重要]** `*` で始まる各セクション（`*PCM`, `*WALL`等）を認識し、適切なパーサー関数にディスパッチするロジックのテスト。 | **高** |
| `AAPL.md` | `appl_test.go` | `DATAIN.go` | - `AAPL`セクションのテキストデータから`ROOM`構造体へのパース処理をテスト。<br>  - `L`, `As`, `Al`, `AE`, `AG` の各キーが正しく解釈されるか。<br>  - スケジュール名が正しく`ROOM`の各`*sch`フィールドにリンクされるか。<br>  - 異常系（不正なキー、値）のテスト。 | 中 |
| `COLL.md` | `equipment_col_test.go` | `eecmpdat_s.go` | - `COLL`セクションのテキストから`COLL`構造体へのパース処理をテスト。<br>  - 全てのパラメータ（`Cp`, `eff`, `Fr`, `UL`等）が正しく設定されるか。<br>  - 必須・オプションパラメータのハンドリングを検証。 | 中 |
| `CONTL.md` | `(未確認)` | `esidcode_s.go` | - `CONTL`セクションの制御ロジック定義のパース処理をテスト。<br>  - 制御タイプ（`ONOFF`, `PI`等）に応じた分岐の検証。<br>  - 制御対象（`T`, `X`等）と条件式のパース検証。 | 高 |
| `dayweek.md` | `(N/A)` | `e79_var_and_consts.go` | - Goソース内の`DAYweek`定数配列が仕様書と完全に一致しているかを確認。 | 低 |
| `EQPCAT.md` | `(未確認)` | `mceqpcat.go` | - `EQPCAT`セクションのテキストから`EQPCAT`構造体へのパース処理をテスト。<br>  - `TYPE`と`CAT`の組み合わせが正しく解釈されるか。 | 中 |
| `EXSRF.md` | `(未確認)` | `GDATA.go` | - `EXSRF`セクションの外部表面定義のパース処理をテスト。<br>  - `Wa` (方位角), `Wb` (傾斜角) が正しく読み込まれるか。 | 中 |
| `GDAT.md` | `(未確認)` | `GDATA.go` | - `GDAT`セクションの全体設定のパース処理をテスト。<br>  - `RUN`, `CITY`, `PERIOD`等のサブセクションが正しく処理されるか。<br>  - 各設定値が`SIMCONTL`構造体に正しく格納されるか。 | **高** |
| `PCM.md` | `blpcm_test.go` | `blpcm.go` | - `*PCM`で始まるテキスト行から`PCM`構造体へのパース処理をテスト。<br>  - 全ての物理量（熱伝導率、潜熱、各温度）が正しく設定されるか。<br>  - オプションの収束計算フラグ（`y`/`n`）のハンドリングを検証。<br>  - 異常系（フィールド数不足、非数値）のテスト。 | **高** |
| `PV.md` | `equipment_pv_test.go` | `eecmpdat_s.go` | - `PV`セクションのテキストから`PV`構造体へのパース処理をテスト。<br>  - 全てのパラメータ（`KHD`, `KPD`, `EffInv`等）が正しく設定されるか。 | 中 |
| `RESI.md` | `resi_test.go` | `DATAIN.go` | - `RESI`セクションのテキストから`ROOM`構造体へのパース処理をテスト。<br>  - `H=`と`comfrt=`の両方の形式を検証。<br>  - スケジュール名が正しくリンクされるか。 | 中 |
| `ROOM.md` | `blroom_test.go` | `DATAIN.go` | - `ROOM`セクションのトップレベルパラメータ（`Vol`, `Hcap`等）のパースをテスト。<br>  - ネストされた部位コンポーネント（`-E`, `-W`等）のパースをテスト。<br>  - 部位の各パラメータ（`area`, `fsol`, `panelname`等）のパースをテスト。<br>  - 出力フラグ（`*s`, `*q`）の解釈をテスト。 | **高** |
| `SCHNM.md`<br>`SCHTB.md` | `schnm_room_test.go` | `eschdata.go` | - `SCHNM`と`SCHTB`の定義をパースし、スケジュールが正しく構築されるかテスト。<br>  - スケジュールタイプ（`T`, `F`等）に応じた値の解釈を検証。<br>  - 他のセクションから正しく参照されるか（結合テストの観点）。 | **高** |
| `STANK.md` | `equipment_stank_test.go` | `eecmpdat_s.go` | - `STANK`セクションのテキストから`STANK`構造体へのパース処理をテスト。<br>  - 全てのパラメータ（`V`, `U`, `H`等）が正しく設定されるか。 | 中 |
| `SUNBRK.md` | `sunbrk_vent_test.go` | `DATAIN.go` | - `SUNBRK`セクションのテキストから`SNBK`構造体へのパース処理をテスト。<br>  - 日除けタイプ（`1`, `2`, `5`等）に応じたパラメータ解釈を検証。 | 中 |
| `SYSCMP.md`<br>`SYSPTH.md` | `(未確認)` | `eesyselmalc_s.go` | - `SYSCMP`（コンポーネント）と`SYSPTH`（接続経路）のパース処理をテスト。<br>  - 複雑な空調システム定義が正しく構造体にマッピングされるか。<br>  - `NODE`の接続関係が正しく構築されるか。 | **高** |
| `VAV.md` | `equipment_vav_test.go` | `eecmpdat_s.go` | - `VAV`セクションのテキストから`VAV`構造体へのパース処理をテスト。<br>  - 全てのパラメータ（`Gmax`, `Gmin`, `bypass`等）が正しく設定されるか。 | 中 |
| `WALL.md` | `blwall_test.go` | `blinit.go` | - `WALL`セクションのヘッダ（`<ewname>`等）と各パラメータのパースをテスト。<br>  - `layer`定義文字列（`<code>[-<L>[/<ND>]]`）の複雑なパース処理をテスト。<br>  - `type`に応じた特殊パラメータ（`tra`, `Ksu`等）の解釈を検証。 | **高** |
| `wbmlist.md` | `(N/A)` | `blinit.go` | - `wbmlist.efl`（または指定ファイル）を読み込み、`BMLST`スライスが正しく構築されるかテスト。 | 中 |

## 3. 実施計画

1.  本計画書に基づき、優先度「高」の項目から順にテストコードの実装に着手する。
2.  各項目について、まず既存のテストコードを確認し、不足分を補う形で新しいテスト関数またはテストケースを追加する。
3.  特に、テキストからのパース処理に関しては、正常系データと異常系データの両方を用いて、パーサーの堅牢性を十分に検証する。
4.  進捗は本計画書に追記する形で管理する。

