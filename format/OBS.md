# OBS（外部障害物定義）

## 概要
OBS（Obstacle）は、建物周辺の外部障害物（隣接建物、構造物等）を定義するデータセットです。これらの障害物による日射遮蔽効果、反射日射、相互放射を正確にシミュレーションすることで、建物の日射環境、冷暖房負荷、昼光利用を詳細に評価できます。都市部における建物間の相互影響や、複雑な敷地条件での環境性能評価に不可欠な機能です。

## データ形式
```
OBS
    <障害物名>
        fname=<形状タイプ>
        x=<X座標> y=<Y座標> z=<Z座標>
        H=<高さ> D=<奥行き> W=<幅>
        Wa=<方位角> Wb=<傾斜角>
        ref=<反射率1> <反射率2> <反射率3> <反射率4>
        rgb=<R> <G> <B>
    ;
    ... 繰り返し
*
```

## パラメータ説明

| パラメータ | 単位 | 説明 | デフォルト値 | 参照 |
|:---|:---|:---|:---|:---|
| 障害物名 | - | 障害物の識別名 | - | 必須 |
| 形状タイプ | - | 障害物の基本形状 | - | 必須 |
| X座標 | m | 左下頂点のX座標 | - | 必須 |
| Y座標 | m | 左下頂点のY座標 | - | 必須 |
| Z座標 | m | 左下頂点のZ座標（地盤高） | - | 必須 |
| 高さ | m | 障害物の高さ | - | 必須 |
| 奥行き | m | 障害物の奥行き | - | 必須 |
| 幅 | m | 障害物の幅 | - | 必須 |
| 方位角 | 度 | 障害物の方位角（北から時計回り） | - | 必須 |
| 傾斜角 | 度 | 障害物の傾斜角（水平面からの角度） | - | 必須 |
| 反射率1-4 | - | 各面の日射反射率（0.0-1.0） | - | 必須 |
| R,G,B | - | 表示色（0.0-1.0） | - | 必須 |

## 形状タイプ一覧

| タイプ | 説明 | 用途 | 面数 |
|:---|:---|:---|:---|
| `rect` | 直方体 | 一般的な建物 | 4面 |
| `cube` | 立方体 | 正方形建物 | 4面 |
| `r_tri` | 直角三角柱 | 三角屋根建物 | 3面 |
| `i_tri` | 二等辺三角柱 | 対称三角屋根建物 | 3面 |

## 使用例

### 基本的な隣接建物
```
OBS
    AdjacentBuilding1
        fname=rect
        x=50.0 y=20.0 z=0.0
        H=30.0 D=40.0 W=20.0
        Wa=0.0 Wb=90.0
        ref=0.3 0.3 0.3 0.3
        rgb=0.8 0.8 0.8 ;
    
    AdjacentBuilding2
        fname=cube
        x=100.0 y=50.0 z=0.0
        H=25.0 D=25.0 W=25.0
        Wa=45.0 Wb=90.0
        ref=0.4 0.4 0.4 0.4
        rgb=0.7 0.7 0.9 ;
*
```

### 複雑な建物群
```
OBS
    HighRiseBuilding
        fname=rect
        x=200.0 y=100.0 z=0.0
        H=100.0 D=60.0 W=40.0
        Wa=30.0 Wb=90.0
        ref=0.2 0.2 0.2 0.2
        rgb=0.6 0.6 0.6 ;
    
    TriangularRoof
        fname=r_tri
        x=150.0 y=200.0 z=0.0
        H=15.0 D=30.0 W=20.0
        Wa=180.0 Wb=90.0
        ref=0.5 0.3 0.4 0.0
        rgb=0.8 0.6 0.4 ;
    
    SymmetricalBuilding
        fname=i_tri
        x=300.0 y=150.0 z=5.0
        H=20.0 D=35.0 W=25.0
        Wa=270.0 Wb=90.0
        ref=0.4 0.4 0.4 0.0
        rgb=0.9 0.8 0.7 ;
*
```

### 地形変化のある敷地
```
OBS
    ElevatedBuilding
        fname=rect
        x=0.0 y=0.0 z=10.0
        H=40.0 D=50.0 W=30.0
        Wa=0.0 Wb=90.0
        ref=0.3 0.3 0.3 0.3
        rgb=0.8 0.8 0.8 ;
    
    SlopedStructure
        fname=rect
        x=80.0 y=80.0 z=-5.0
        H=20.0 D=40.0 W=20.0
        Wa=45.0 Wb=75.0
        ref=0.4 0.4 0.4 0.4
        rgb=0.7 0.8 0.6 ;
*
```

## 座標系と方位角

### 座標系の定義
- **X軸**: 東方向が正
- **Y軸**: 北方向が正
- **Z軸**: 上方向が正
- **原点**: 対象建物の基準点

### 方位角の定義
- **0度**: 北向き
- **90度**: 東向き
- **180度**: 南向き
- **270度**: 西向き

### 傾斜角の定義
- **0度**: 水平
- **90度**: 垂直
- **45度**: 45度傾斜

## 反射率の設定

### 面の対応関係
直方体（rect/cube）の場合：
- **反射率1**: 正面（方位角方向）
- **反射率2**: 右側面
- **反射率3**: 背面
- **反射率4**: 左側面

三角柱（r_tri/i_tri）の場合：
- **反射率1**: 正面
- **反射率2**: 右側面
- **反射率3**: 左側面
- **反射率4**: 未使用（0.0設定）

### 材料別反射率の目安
| 材料 | 反射率 | 用途 |
|:---|:---|:---|
| コンクリート | 0.2-0.4 | 一般建物 |
| 白色塗装 | 0.7-0.9 | 高反射建物 |
| ガラス | 0.1-0.3 | カーテンウォール |
| 金属 | 0.3-0.7 | 工業建築 |
| レンガ | 0.3-0.5 | 伝統建築 |

## 日射遮蔽効果の計算

### 影の投影
障害物による影は、太陽位置と障害物の形状から幾何学的に計算されます：
1. **太陽位置**: 日時・緯度・経度から算出
2. **影の形状**: 障害物の3D形状から投影
3. **遮蔽率**: 対象面への影の重なり面積

### 反射日射の計算
障害物からの反射日射も考慮されます：
```
反射日射 = 入射日射 × 反射率 × 形態係数
```

## 設計上の考慮事項

### 周辺環境の調査
1. **建物配置**: 隣接建物の正確な位置・形状
2. **高さ関係**: 対象建物との高さ比較
3. **距離関係**: 日射遮蔽に影響する範囲
4. **将来計画**: 周辺開発計画の考慮

### モデル化の精度
- **重要度**: 日射に大きく影響する障害物を優先
- **簡略化**: 遠方の障害物は簡略形状で近似
- **詳細化**: 近接する大型障害物は詳細にモデル化

## 都市環境での活用

### ヒートアイランド対策
```
OBS
    HighReflectanceBuilding
        fname=rect
        x=100.0 y=100.0 z=0.0
        H=50.0 D=40.0 W=30.0
        Wa=0.0 Wb=90.0
        ref=0.8 0.8 0.8 0.8  !  高反射率
        rgb=0.9 0.9 0.9 ;
*
```

### 日影規制の検討
```
OBS
    ProposedBuilding
        fname=rect
        x=50.0 y=50.0 z=0.0
        H=60.0 D=30.0 W=20.0
        Wa=0.0 Wb=90.0
        ref=0.3 0.3 0.3 0.3
        rgb=0.8 0.8 0.8 ;
*
```

## 出力データ

障害物に関する以下の項目が出力されます：
- 各面への入射日射量
- 反射日射量
- 対象建物への日射遮蔽率
- 形態係数
- 相互放射量

## 関連データセット

- [TREE](TREE.md): 樹木による日射遮蔽
- [POLYGON](POLYGON.md): 複雑形状の障害物
- [COORDNT](COORDNT.md): 座標変換・日射計算
- [SUNBRK](SUNBRK.md): 建物付属の日除け
- [EXSRF](EXSRF.md): 外表面・方位の定義

## 注意事項

1. **座標精度**: 正確な測量データに基づく座標設定
2. **形状近似**: 複雑な形状の適切な近似方法
3. **反射率設定**: 実際の材料特性に基づく設定
4. **計算負荷**: 障害物数の増加による計算時間への影響
5. **更新管理**: 周辺環境変化に応じた定期的な更新